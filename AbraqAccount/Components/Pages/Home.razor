@page "/"
@using AbraqAccount.Models.Common
@using Microsoft.AspNetCore.Http
@using AbraqAccount.Models.Common
@using AbraqAccount.Extensions
@inject IHttpContextAccessor HttpContextAccessor
@inject NavigationManager NavigationManager
@using AbraqAccount.Components.Layout
@layout EmptyLayout

@code {

    protected override void OnInitialized()
    {
        var context = HttpContextAccessor.HttpContext;
        try
        {
            if (context != null && context.Session != null)
            {
                var userSession = context.Session.GetObject<UserSession>(SessionKeys.UserSession);
                if (userSession == null)
                {
                    NavigationManager.NavigateTo("login");
                    return;
                }
                // If userSession is not null, navigate to dashboard
                NavigationManager.NavigateTo("dashboard");
                return;
            }
            // If context or session is null
            NavigationManager.NavigateTo("login");
        }
        catch (NavigationException)
        {
            // Prevent debugger break on redirection
        }
    }
}
